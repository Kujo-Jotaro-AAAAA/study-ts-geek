# ç¬¬ä¸‰èŠ‚: ç±»å‹æ£€æŸ¥æœºåˆ¶&é«˜çº§ç±»å‹

## ç±»å‹æ£€æŸ¥æœºåˆ¶

`TS`ä¼šæ ¹æ®ä¸€å®šçš„è§„åˆ™, è‡ªåŠ¨æ¨æ–­å‡ºå½“å‰ä½¿ç”¨çš„ç±»å‹, åˆ†ä¸º: **åŸºç¡€ç±»å‹**ã€**æœ€ä½³é€šç”¨ç±»å‹**ã€**ä¸Šä¸‹æ–‡ç±»å‹**ã€‚

- åŸºç¡€ç±»å‹æ¨æ–­

```ts
let a = 1;
// => ç­‰ä»·äº
// let a: number = 1;
let b = false;
// let b:boolean = false;
```

- æœ€ä½³é€šç”¨ç±»å‹

å½“æœ‰ä¸¤ä¸ªä»¥ä¸Šç±»å‹æ—¶, ä¼šè‡ªåŠ¨æ¨æ–­ä¸ºå›Šæ‹¬è¿™äº›ç±»å‹çš„å®šä¹‰ã€‚

```ts
let arr = [1,null, 'a'];
```

![](../md-imgs/ç±»å‹æ¨æ–­.png)

`tsconfig.json`å…³é—­[ä¸¥æ ¼ç©ºæ ¡éªŒæ¨¡å¼](https://segmentfault.com/a/1190000007002883), ä¼šè®© `null` å’Œå…¶ä»–ç±»å‹å…¼å®¹ã€‚

`strictNullChecks: false` 

![](../md-imgs/ä¸¥æ ¼ç©ºæ ¡éªŒæ•ˆæœ.png)

ä»¥ä¸Šä¸¤ç§æ¨æ–­ï¼Œéƒ½æ˜¯ä»¥å€¼æ¥æ¨æ–­ç±»å‹(å³å‘å·¦æ¨æ–­)ã€‚

- ä¸Šä¸‹æ–‡æ¨æ–­

é€šå¸¸å‘ç”Ÿåœ¨å‡½æ•°ç»‘å®šä¸­, ä»¥ç»‘å®šçš„äº‹ä»¶æ¥æ¨æ–­å‡ºå‚æ•°å…·æœ‰çš„å±æ€§(å·¦â†’å³)ã€‚

~~è§†é¢‘é‡Œæ˜¯ä¸ç”¨åŠ `KeyboardEvent`ä½†æˆ‘å°±æ˜¯æ²¡æœ‰ğŸ¶~~

![](../md-imgs/ä¸Šä¸‹æ–‡æ¨æ–­.png)



### ç±»å‹æ–­è¨€

æ˜ç¡®çŸ¥é“æ•°æ®çš„ç±»å‹

```ts
interface API {
    id: number;
}
let api = {} as API;
```



### å…¼å®¹ç±»å‹

**å…¼å®¹**: `A` å…¼å®¹ `B`, `A` å¯ä»¥èµ‹å€¼ç»™ `B`

å½“ä¸€ä¸ªç±»å‹A å¯ä»¥èµ‹å€¼ç»™å¦ä¸€ä¸ªç±»å‹ `B` æ—¶, å°±å«åšå…¼å®¹ç±»å‹ã€‚

æœ€åŸºæœ¬çš„, é»˜è®¤é…ç½®ä¸‹ `string` æ— æ³•èµ‹å€¼ç»™ `null`ã€‚

<img src="../md-imgs/advance01.png" style="zoom:50%;" />

å½“è®¾ç½®ä¸º `"strictNullChecks": false`

![](../md-imgs/advance02.png)

- æ¥å£å…¼å®¹

1. åœ¨ä¾‹å­ä¸­, `Y` æ¥å£åŒ…å«äº† `X` æ¥å£çš„æ‰€æœ‰ç±»å‹, `x` å¯ä»¥èµ‹å€¼ç»™ `y`

2. å­—æ®µå°‘çš„å…¼å®¹å­—æ®µå¤šçš„

```ts
interface X {
  a: any;
}
interface Y {
  a: any;
  b: any;
}
let x:X = {a: 1};
let y:Y = {a: 1, b: 1};
// ok
x = y

// error
y = x
```



### å‡½æ•°å…¼å®¹
- å‚æ•°ä¸ªæ•°
1. å‚æ•°å¤šçš„å…¼å®¹å‚æ•°å°‘çš„
2. å›ºå®šå‚æ•°å…¼å®¹å¯é€‰å’Œå‰©ä½™å‚æ•°
3. å¯é€‰å‚æ•°ä¸å…¼å®¹å‰©ä½™å‚æ•°
   + å¯è®¾ç½® `"strictFunctionTypes": false`,è®©å…¶å…¼å®¹
4. å‰©ä½™å‚æ•°å¯ä»¥å…¼å®¹å›ºå®šå‚æ•°å’Œå¯é€‰å‚æ•°

- å‚æ•°ç±»å‹
1. å‚æ•°ç±»å‹å¿…é¡»åŒ¹é…
2. å½“å‚æ•°æ˜¯å¯¹è±¡æ—¶, **å­—æ®µå¤šçš„å…¼å®¹å­—æ®µå°‘çš„** ä¸æ¥å£åˆ¤æ–­è§„åˆ™æ˜¯ç›¸åçš„ã€‚

- è¿”å›å€¼ç±»å‹

1. å‚æ•°å°‘çš„å…¼å®¹å‚æ•°å¤šçš„
2. å‚æ•°ç±»å‹èŒƒå›´å¤šå…¼å®¹èŒƒå›´å°‘çš„

```ts
// demo: å‚æ•°ä¸ªæ•°å…¼å®¹
let x = (x: number, y: number, z: number) => {};
let y = (x: number, y?: number) => {};
let z = (...rest: number[]) = {};
x = y;
x = z;
y = x; // error 
y = z;
z = x;
z = y;
```

```ts
// demo:å‚æ•°ç±»å‹
let x = (x: number) => {};
let y = (y: number) => {};
// let y = (y: string) => {}; error ç±»å‹ä¸å…¼å®¹
// let y = (y: any) => {};
x = y;
```

```ts
interface XParams {
  a: number;
}
interface YParams {
  a: number;
  b: number;
}
let x = (x: XParams) => {};
let y = (y: YParams) => {};
x = y; // error ä¸æ¥å£å…¼å®¹ä¸ä¸€æ ·å“¦, è¿™é‡Œæ˜¯å¤šçš„å…¼å®¹å°‘çš„
y = x;
// ã€Œ è¿”å›å€¼ç±»å‹ ã€
let x = () => ({x: ''});
let y = () => ({y: 1});
let z = () => ({y: 1});

// error
x = y
y = z;
```

### ç±»å‹ä¿æŠ¤

~~`TS`èƒ½å¤Ÿåœ¨ç‰¹å®šçš„åŒºå—ä¸­ä¿è¯å˜é‡å±äºæŸç§ç¡®å®šç±»å‹~~

è‡ªå·±å†™ç±»å‹æ£€æŸ¥,å‘Šè¯‰ `TS`è¿™å˜é‡æ˜¯å•¥ç±»å‹ã€‚

`is` ç±»å‹ä½è¯ã€‚ä½¿ç”¨:  **å‚æ•° `is` ç±»å‹** 

```ts
class Java {
  sayJava(){}
}
class JavaScript {
  sayJavaScript(){}
}
function getlang(param: Java | JavaScript) {
  // error 
  // param.sayJava

  // 1. instanceof
  // if (param instanceof Java) {
  //   param.sayJava
  // } else {
  //   param.sayJavaScript
  // }

  // 2. in
  // if ('sayJava' in param) {
  //   param.sayJava
  // }

  // 4 å®ç°
  if (isJava(param)) {
    param.sayJava()
  }
}
// 3. typeof
function getType(x: string | number) {
  if ( typeof x === 'string') {
    console.log(x.length);
  } else {
    console.log(x.toFixed(2));
  }
}
// 4 é€šè¿‡ç±»å‹ä½è¯ is è‡ªå·±å®ç°åˆ¤æ–­å‡½æ•°
function isJava(lang: Java | JavaScript): lang is Java {
  return (lang as Java).sayJava !== undefined
}
```

### äº¤å‰ç±»å‹

`&` å°†ä¸¤ä¸ªç±»å‹ç»„åˆèµ·æ¥, å£°æ˜åè¦å®ç°ä¸¤ä¸ªç±»å‹éƒ½æœ‰çš„æ–¹æ³•ã€‚

```ts
interface Str {
  x: string;
}
interface Num {
  y: number;
}
// å–ä¸¤è€…å¹¶é›†
const obj : Str & Num = {
  x: 'a',
  y: 1
}
// å¦‚æœæ˜¯ class , å–ä¸¤è€…çš„äº¤é›†
```

### è”åˆç±»å‹

```ts
let a: number | string = 'a';
// å­—é¢é‡ç±»å‹
let b: 'x' | 'y' | 'z' = 'x';
let c: 1 | 2 | 3 = 1;
```

### â˜†ç´¢å¼•ç±»å‹

`keyof`: ç´¢å¼•ç±»å‹æŸ¥è¯¢æ“ä½œç¬¦

`T['key']`: ç´¢å¼•è®¿é—®æ“ä½œç¬¦

æ³›å‹çº¦æŸ`T extends U`

```ts
interface Obj {
  a: number,
  b: number,
}
const obj1 = {
  a: 1,
  b: 2
}
const obj2 = {
  f: 1,
  e: 2
}
function getValue(obj: any, keys: string[]) {
  return keys.map(key => {
    let val = obj[key];
    return val;
  })
}
getValue(obj1, ['a']); // ok
getValue(obj2, ['a']); // obj2 é‡Œæ²¡æœ‰ a, æŠ¥é”™æ‰å¯¹
```

1.å°†å‚æ•° `obj` æŒ‡å®šä¸ºä¸€ä¸ªæ³›å‹`T`ã€‚

2.æŒ‡å®šç¬¬äºŒä¸ªæ³›å‹`U` çº¦æŸä¸º`T` çš„ç´¢å¼•ã€‚

3.å°†è¿”å›å€¼æŒ‡å®šä¸º`T[U]`çš„ç´¢å¼•ç¬¦æ•°ç»„ã€‚

```ts
// ç´¢å¼•ç±»å‹åº”ç”¨
function getValue<T, U extends keyof T>(obj: T, keys: U[]): T[U][] {
  return keys.map(key => {
    let val = obj[key];
    return val;
  })
}
```

![](../md-imgs/ç´¢å¼•ç±»å‹.png)

### æ˜ å°„ç±»å‹

æ›´å¤šç±»å‹,`âŒ˜ + å·¦é”®` å»å®ƒå†…åº“ä¸­çœ‹

- åŒæ€

å·²åŸç±»å‹ä¸ºåŸºç¡€, ç”Ÿæˆæ–°ç±»å‹ï¼Œä¸ä¼šå¢åŠ æ–°å±æ€§ã€‚

```ts
interface Obj {
  a: string;
  b: number;
  c: boolean;
}

// ç”Ÿæˆå…¨éƒ¨åªè¯»çš„ç±»å‹
type ReadonlyObj = Readonly<Obj>;

// ç”Ÿæˆå…¨éƒ¨å¯é€‰çš„ç±»å‹
type PartialObj = Partial<Obj>;

// æŠ½å–æŸå‡ ä¸ªå±æ€§
type PickObj = Pick<Obj, 'a' | 'b'>;
```

- éåŒæ€

ä¸ä»¥åŸç±»å‹ä¸ºåŸºç¡€çš„, æ‰¹é‡ç”Ÿæˆå±æ€§ã€‚

```ts
type RecordObj = Record<'d' | 'e', string>;
```

### æ¡ä»¶ç±»å‹

è¯­æ³•:` T extends U ? x : y`

```ts
type ConditionType<T> = T extends string ? 'a' : 1;
type ConditionStr = ConditionType<string>
type ConditionNum = ConditionType<number>
```



[ç¬¬å››ç¯‡ï¼šå·¥ç¨‹åŒ–](./04-22~31.md)





